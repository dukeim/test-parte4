groups:
  - name: spring-alerts
    rules:
      - alert: HighErrorRate
        expr: rate(http_server_requests_seconds_count{status=~"5.."}[2m])
              / rate(http_server_requests_seconds_count[2m]) > 0.1
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Se ha detectado una tasa de errores alta"
          description: "Mas del 10% de las peticiones han fallado con 5xx en los últimos 2 minutos."

      - alert: HighLatencyWarning
        expr: histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket[5m])) by (le)) > 0.2
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Alta latencia - warning"
          description: "La latencia del percentil 95 (P95) excedió los 200 ms durante más de 2 minutos."

      - alert: HighLatencyCritical
        expr: histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket[5m])) by (le)) > 0.3
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Alta latencia - critical"
          description: "La latencia del percentil 95 (P95) excedió los 300 ms durante más de 2 minutos."